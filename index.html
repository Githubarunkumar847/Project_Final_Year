<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Membrane Performance Analysis</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js"></script>

<style>
body {
    margin: 0;
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    background: #f4f6f8;
    color: #333;
}

header {
    background: #0b5ed7;
    color: white;
    padding: 16px 32px;
    font-size: 22px;
    font-weight: 600;
}

.container {
    display: grid;
    grid-template-columns: 260px 1fr;
    height: calc(100vh - 64px);
}

.sidebar {
    background: #ffffff;
    border-right: 1px solid #ddd;
    padding: 20px;
}

.sidebar h3 {
    margin-top: 0;
    font-size: 16px;
    color: #0b5ed7;
}

.sidebar button {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    background: #e9f1ff;
    border: 1px solid #cfe0ff;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
}

.sidebar button:hover {
    background: #d6e6ff;
}

.main {
    padding: 24px;
    display: flex;
    flex-direction: column;
}

textarea {
    width: 100%;
    height: 120px;
    font-family: Consolas, monospace;
    font-size: 14px;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    resize: vertical;
}

.run-btn {
    align-self: flex-end;
    margin-top: 10px;
    padding: 10px 18px;
    background: #0b5ed7;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
}

.run-btn:hover {
    background: #094bb5;
}

.result {
    margin-top: 20px;
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
    background: white;
}

th, td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
    text-align: center;
    font-size: 14px;
}

th {
    background: #f1f3f5;
    font-weight: 600;
}
</style>
</head>

<body>

<header>
    Electrospun PAN/MXene/TiO₂ Membrane – SQL Performance Analysis
</header>

<div class="container">

    <!-- Sidebar -->
    <div class="sidebar">
        <h3>Quick Analysis</h3>

        <button onclick="setQuery(showAll)">
            Show Full Dataset
        </button>

        <button onclick="setQuery(bestSolvent)">
            Best Solvent (Overall)
        </button>

        <button onclick="setQuery(viscosityEffect)">
            Flux vs Viscosity
        </button>

        <button onclick="setQuery(systemComparison)">
            Immiscible vs Emulsion
        </button>

        <button onclick="setQuery(solventRanking)">
            Solvent Ranking Score
        </button>
    </div>

    <!-- Main -->
    <div class="main">

        <textarea id="query"></textarea>

        <button class="run-btn" onclick="runQuery()">Run Query</button>

        <div class="result" id="output"></div>

    </div>
</div>

<script>
let db;

/* ---------- Predefined Queries ---------- */

const showAll = `
SELECT * FROM performance;
`;

const bestSolvent = `
SELECT solvent,
AVG(flux_lmh) AS avg_flux,
AVG(efficiency_pct) AS avg_efficiency
FROM performance
GROUP BY solvent
ORDER BY avg_flux DESC;
`;

const viscosityEffect = `
SELECT oil_type,
viscosity_cp,
AVG(flux_lmh) AS avg_flux
FROM performance
GROUP BY oil_type, viscosity_cp
ORDER BY viscosity_cp;
`;

const systemComparison = `
SELECT system_type,
AVG(flux_lmh) AS avg_flux,
AVG(efficiency_pct) AS avg_efficiency
FROM performance
GROUP BY system_type;
`;

const solventRanking = `
SELECT solvent,
AVG((flux_lmh/3000.0 + efficiency_pct/99.0)/2) AS overall_score
FROM performance
GROUP BY solvent
ORDER BY overall_score DESC;
`;

/* ---------- Utility ---------- */

function setQuery(q) {
    document.getElementById("query").value = q;
}

/* ---------- Load CSV ---------- */

async function loadCSV() {
    const response = await fetch("performance.csv");
    const text = await response.text();

    const rows = text.trim().split("\n");
    rows.shift(); // remove header

    rows.forEach(row => {
        const values = row.split(",");
        db.run(
            `INSERT INTO performance VALUES (?, ?, ?, ?, ?, ?)`,
            values
        );
    });
}

/* ---------- Initialize SQL ---------- */

initSqlJs({
  locateFile: file =>
    `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/${file}`
}).then(async SQL => {

    db = new SQL.Database();

    db.run(`
        CREATE TABLE performance (
            solvent TEXT,
            system_type TEXT,
            oil_type TEXT,
            viscosity_cp REAL,
            flux_lmh REAL,
            efficiency_pct REAL
        );
    `);

    await loadCSV();
    setQuery(showAll);
});

/* ---------- Run Query ---------- */

function runQuery() {
    try {
        const query = document.getElementById("query").value;
        const result = db.exec(query);

        if (!result.length) {
            document.getElementById("output").innerHTML =
                "<b>No results returned.</b>";
            return;
        }

        let html = "<table><tr>";
        result[0].columns.forEach(col => html += `<th>${col}</th>`);
        html += "</tr>";

        result[0].values.forEach(row => {
            html += "<tr>";
            row.forEach(val => html += `<td>${val}</td>`);
            html += "</tr>";
        });

        html += "</table>";
        document.getElementById("output").innerHTML = html;

    } catch (err) {
        document.getElementById("output").innerHTML =
            `<span style="color:red;">SQL Error: ${err.message}</span>`;
    }
}
</script>

</body>
</html>
